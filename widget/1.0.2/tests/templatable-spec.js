define(function(e){var t=e("../src/widget"),n=e("../src/templatable"),r=e("handlebars"),i=e("$");describe("Templatable",function(){var e=t.extend({Implements:n});test("normal usage",function(){var t=new e({template:"<div><h3>{{title}}</h3><p>{{content}}</p></div>",model:{title:"Big Bang",content:"It is very cool."}});expect(t.$("h3").text()).toBe("Big Bang"),expect(t.$("p").text()).toBe("It is very cool.")}),test("Handlebars helpers",function(){var t=e.extend({templateHelpers:{link:function(e){return new r.SafeString('<a href="'+e.href+'">'+e.text+"</a>")}}}),n=new t({template:"<p>{{link item}}</p>",model:{item:{href:"http://google.com/",text:"google"}}});expect(n.element.html().toLowerCase()).toBe('<a href="http://google.com/">google</a>')}),test("renderPartial",function(){var t=new e({template:'<div id="t"><h3>{{title}}</h3><div>{{content}}</div></div>',model:{title:"This is a title",content:"This is content"}});t.render(),expect(i("#t")[0]).toBe(t.element[0]),t.model={title:"xxx"},t.renderPartial("h3"),expect(t.$("h3").html()).toBe("xxx"),t.element.remove()}),test("template expression in invalid place",function(){var t=new e({template:'<table id="t"><tbody><tr><td>&lt;!--{{xx}}--&gt;</td>{{#each items}}<td class="item-{{this}}">{{this}}</td>{{/each}}</tr></tbody></table>',model:{xx:"xx",items:[1,2,3,4,5,6,7,8,9]}});t.render(),expect(i("#t tbody td").length).toBe(10),expect(i("#t tbody td").eq(1).hasClass("item-1")).toBe(!0),expect(i("#t tbody td").eq(0).html()).toBe("&lt;!--xx--&gt;"),t.model={xx:"xx",items:[1,2,3,4,5]},t.renderPartial("tbody tr"),expect(i("#t tbody td").length).toBe(6),expect(i("#t tbody td").eq(1).hasClass("item-1")).toBe(!0),expect(i("#t tbody td").eq(0).html()).toBe("&lt;!--xx--&gt;"),t.element.remove()}),test("model.toJSON()",function(){var t=e.extend({}),n=new t({template:"<div>{{content}}</div>",model:{toJSON:function(){return{content:"xx"}}}});n.render(),expect(n.element.html()).toBe("xx")}),test("#10: src expression in template string",function(){var t=new e({template:'<div id="t10"><h3>{{title}}</h3><div class="content">{{content}}<img src="{{src}}"></div></div>',model:{title:"This is a title",content:"This is content",src:"https://i.alipayobjects.com/e/201207/36PCiRAolN.jpg"}});t.render(),t.model.content="content 2",t.renderPartial("div.content"),expect(t.$("div.content").html().indexOf("content 2")===0).toBe(!0),expect(t.$("div.content").html().toLowerCase().indexOf("img")>0).toBe(!0)}),test("#7: render twice",function(){var t=0,n=e.extend({attrs:{content:"1"},_onRenderContent:function(e){t++,this.model.content=e,this.renderPartial("div.content")},template:'<div id="t7"><h3>{{title}}</h3><div class="content">{{content}}</div></div>',model:{title:"This is a title",content:"This is content"}}),r=new n({content:"2"});r.render(),expect(t).toBe(1),r.set("content","2"),expect(t).toBe(1),r.set("content","3"),expect(t).toBe(2)})})});